<div class="expansion-panel">
    <mat-accordion>
        <mat-expansion-panel>

            <!-- Panel Header -->
            <mat-expansion-panel-header>

                <!-- Panel Title -->
                <mat-panel-title>
                    Filter Options
                </mat-panel-title>

                <!-- Panel Description -->
                <mat-panel-description>

                    <!-- Settings Icon -->
                    <mat-icon>filter_alt</mat-icon>

                    <!-- Filters Applied -->
                    <span *ngIf="filterText">
                        {{ filterText }}
                    </span>

                    <!-- Message to be shown on the panel -->
                    <span *ngIf="message" class="message" [innerHtml]="message | safeHtml"></span>

                </mat-panel-description>

            </mat-expansion-panel-header>

            <!-- Filters -->
            <form>

                <!-- Misc Filters -->
                <fieldset class="field_set">

                    <legend>
                        Misc Filters
                    </legend>

                    <div class="filter-container">

                        <!-- Org ID -->
                        <mat-form-field>
                            <mat-label>Organisation ID</mat-label>
                            <input matInput [formControl]="filterFormControls.organisationId" placeholder="e.g. Y00082" (input)="onorganisationIdInput($event)">
                            <button *ngIf="filterFormControls.organisationId.value" matSuffix mat-icon-button aria-label="Clear" (click)="filterFormControls.organisationId.setValue(null)" tabindex="-1">
                                <mat-icon>close</mat-icon>
                            </button>
                        </mat-form-field>

                        <!-- Name -->
                        <mat-form-field>
                            <mat-label>Organisation Name</mat-label>
                            <input matInput [formControl]="filterFormControls.name" placeholder="e.g. Medical Practice">
                            <button *ngIf="filterFormControls.name.value" matSuffix mat-icon-button aria-label="Clear" (click)="filterFormControls.name.setValue(null)" tabindex="-1">
                                <mat-icon>close</mat-icon>
                            </button>
                        </mat-form-field>

                        <!-- Status -->
                        <mat-form-field>
                            <mat-label>Status</mat-label>
                            <mat-select [formControl]="filterFormControls.status" placeholder="Select a status">
                                <mat-option [value]="null"></mat-option>
                                <mat-option *ngFor="let s of status" [value]="s.id">
                                    {{ s.displayName }}
                                </mat-option>
                            </mat-select>
                            <button *ngIf="filterFormControls.status.value" matSuffix mat-icon-button aria-label="Clear"
                                (click)="filterFormControls.status.setValue(null)">
                                <mat-icon>close</mat-icon>
                            </button>
                        </mat-form-field>

                        <!-- Primary Role -->
                        <mat-form-field>

                            <!-- Label -->
                            <mat-label>
                                Primary Role
                            </mat-label>

                            <!-- Primary Role List -->
                            <mat-select
                                #primaryRoleSelect
                                [formControl]="filterFormControls.primaryRoles"
                                placeholder="Select Role(s)"
                                multiple
                                [panelClass]="['long-list', 'select-icon']"
                            >
                                <mat-option *ngFor="let role of (primaryRoles$ | async)" [value]="role.id" class="small-font">
                                    <div class="select-container">
                                        <div class="select-display-name">
                                            {{ role.display_name }}
                                        </div>
                                        <div>
                                            <img *ngIf="role.icon" [src]="role.icon" />
                                        </div>
                                    </div>
                                </mat-option>
                            </mat-select>

                            <!-- Clear Contents -->
                            <button
                                *ngIf="filterFormControls.primaryRoles.value?.length || 0 > 0"
                                matSuffix
                                mat-icon-button
                                aria-label="Clear"
                                (click)="filterFormControls.primaryRoles.setValue(null)"
                            >
                                <mat-icon>close</mat-icon>
                            </button>

                        </mat-form-field>

                        <!-- Non Primary Role -->
                        <mat-form-field *ngIf="false">

                            <!-- Label -->
                            <mat-label>
                                Non Primary Role
                            </mat-label>

                            <!-- Non Primary Role List -->
                            <mat-select
                                #nonPrimaryRoleSelect
                                [formControl]="filterFormControls.nonPrimaryRoles"
                                placeholder="Select Role(s)"
                                multiple
                                panelClass="long-list"
                            >
                                <mat-option *ngFor="let role of (nonPrimaryRoles$ | async)" [value]="role.id">
                                    {{ role.display_name }}
                                </mat-option>
                            </mat-select>

                            <!-- Clear Contents -->
                            <button
                                *ngIf="filterFormControls.nonPrimaryRoles.value?.length || 0 > 0"
                                matSuffix
                                mat-icon-button
                                aria-label="Clear"
                                (click)="filterFormControls.nonPrimaryRoles.setValue(null)"
                            >
                                <mat-icon>close</mat-icon>
                            </button>

                        </mat-form-field>

                        <!-- Last Change Date -->
                        <mat-form-field>
                            <mat-label>Last Changed After</mat-label>
                            <input matInput [matDatepicker]="picker" [formControl]="filterFormControls.lastChangeDate" [max]="maxDate">
                            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                            <button *ngIf="filterFormControls.lastChangeDate.value" matSuffix mat-icon-button aria-label="Clear" (click)="filterFormControls.lastChangeDate.setValue(null)">
                                <mat-icon>close</mat-icon>
                            </button>
                        </mat-form-field>

                        <div class="filter-spacer">

                        </div>

                    </div>

                </fieldset>

                <div class="spacer"></div>

                <!-- Postcode Filters -->
                <fieldset class="field_set">

                    <legend>
                        Postcode Filters
                    </legend>

                    <div class="filter-container">

                        <!-- Postcode -->
                        <mat-form-field>
                            <mat-label>Postcode</mat-label>
                            <input matInput [formControl]="filterFormControls.postcode" placeholder="e.g. DA14" (input)="onPostcodeInput($event)">
                            <button *ngIf="filterFormControls.postcode.value" matSuffix mat-icon-button aria-label="Clear" (click)="filterFormControls.postcode.setValue(null)" tabindex="-1">
                                <mat-icon>close</mat-icon>
                            </button>
                        </mat-form-field>

                        <!-- Admin County -->
                        <app-async-select
                            label="Admin County"
                            [fControl]="filterFormControls.adminCounty"
                            [data]="(adminCounty$ | async) || []"
                        ></app-async-select>

                        <!-- Admin District -->
                        <app-async-select
                            label="Admin District"
                            [fControl]="filterFormControls.adminDistrict"
                            [data]="(adminDistrict$ | async) || []"
                        ></app-async-select>

                        <!-- Parliamentary Constituency -->
                        <app-async-select
                            label="Parliamentary Constituency"
                            [fControl]="filterFormControls.parliamentaryConstituency"
                            [data]="(parliamentaryConstituency$ | async) || []"
                        ></app-async-select>

                        <!-- Police Force Area -->
                        <app-async-select
                            label="Police Force Area"
                            [fControl]="filterFormControls.policeForceArea"
                            [data]="(policeForceArea$ | async) || []"
                        ></app-async-select>

                        <!-- Nuts -->
                        <app-async-select
                            label="NUTS"
                            [fControl]="filterFormControls.nuts"
                            [data]="(nuts$ | async) || []"
                        ></app-async-select>

                        <!-- Postcode Area -->
                        <app-async-select
                            label="Postcode Area"
                            [fControl]="filterFormControls.postcodeArea"
                            [data]="(postcodeArea$ | async) || []"
                        ></app-async-select>

                        <!-- European Electoral Region -->
                        <app-async-select
                            label="European Electoral Region"
                            [fControl]="filterFormControls.europeanElectoralRegion"
                            [data]="(europeanElectoralRegion$ | async) || []"
                        ></app-async-select>

                        <!-- Health Authority -->
                        <app-async-select
                            label="Health Authority"
                            [fControl]="filterFormControls.healthAuthority"
                            [data]="(healthAuthority$ | async) || []"
                        ></app-async-select>

                        <!-- Primary Care Trust -->
                        <app-async-select
                            label="Primary Care Trust"
                            [fControl]="filterFormControls.primaryCareTrust"
                            [data]="(primaryCareTrust$ | async) || []"
                        ></app-async-select>

                        <!-- Region -->
                        <app-async-select
                            label="Region"
                            [fControl]="filterFormControls.region"
                            [data]="(region$ | async) || []"
                        ></app-async-select>

                        <!-- Country -->
                        <app-async-select
                            label="Country"
                            [fControl]="filterFormControls.country"
                            [data]="(country$ | async) || []"
                        ></app-async-select>

                    </div>

                </fieldset>

            </form>

        </mat-expansion-panel>

    </mat-accordion>

    <!-- Refresh Data -->
    <div class="button-container">
        <app-async-button
            buttonText=""
            colour="primary"
            icon="sync"
            [loaded]="true"
            (clickEvent)="refreshData()"
        ></app-async-button>
    </div>

</div>
